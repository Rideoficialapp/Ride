<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ride - Comprar Suscripción</title>

  <!-- Fuente Montserrat -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap"
    rel="stylesheet"
  />

  <!-- Estilos -->
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <nav class="navbar">
      <ul class="nav-links">
        <li><a href="index.html">Inicio</a></li>
        <li><a href="drivers.html">Socios Conductores</a></li>
        <li><a href="passengers.html">Pasajeros</a></li>
        <li><a href="planes.html">Planes</a></li>
        <li><a href="compra.html" class="btn-buy active-link">Comprar</a></li>
      </ul>
    </nav>
  </header>

  <!-- SECCIÓN COMPRA DE SUSCRIPCIÓN -->
  <section class="purchase-section">
    <div class="container">
      <h1>Comprar Suscripción Ride</h1>
      <p>
        Selecciona tu vehículo, el plan que mejor se ajuste a tus objetivos
        y realiza tu pago para recibir tu código de activación.
      </p>

      <!-- FORMULARIO (ENVÍA A create_transaction.php) -->
      <form class="purchase-form" action="create_transaction.php" method="post">
        <!-- Tipo de Vehículo -->
        <div class="form-group">
          <label for="vehicle">¿Con qué vehículo trabajarás?</label>
          <select id="vehicle" name="vehicle" required>
            <option value="" disabled selected>Selecciona una opción</option>
            <option value="car">Carro</option>
            <option value="moto">Moto</option>
          </select>
        </div>

        <!-- Selección de Plan (filtrado dinámicamente según vehículo) -->
        <div class="form-group">
          <label for="plan">Selecciona tu Plan:</label>
          <select id="plan" name="plan" required disabled>
            <option value="" disabled selected>
              Primero elige tu vehículo
            </option>

            <!-- Planes para Carro -->
            <option
              value="CAR-BASIC"
              data-vehicle="car"
            >
              Básico Carro ($50 / $600 límite)
            </option>
            <option
              value="CAR-INTERMEDIATE"
              data-vehicle="car"
            >
              Intermedio Carro ($100 / $1200 límite)
            </option>
            <option
              value="CAR-PREMIUM"
              data-vehicle="car"
            >
              Premium Carro ($150 / Ilimitado)
            </option>

            <!-- Planes para Moto -->
            <option
              value="M-BASIC"
              data-vehicle="moto"
            >
              Básico Moto ($25 / $300 límite)
            </option>
            <option
              value="M-INTERMEDIATE"
              data-vehicle="moto"
            >
              Intermedio Moto ($45 / $600 límite)
            </option>
            <option
              value="M-PREMIUM"
              data-vehicle="moto"
            >
              Premium Moto ($60 / $900 límite)
            </option>
          </select>
          <small class="helper-text">
            Solo verás los planes disponibles para el tipo de vehículo seleccionado.
          </small>
        </div>

        <!-- Datos del Comprador -->
        <div class="form-group">
          <label for="name">Nombre Completo:</label>
          <input
            type="text"
            id="name"
            name="name"
            placeholder="Ej. Juan Pérez"
            required
          />
        </div>

        <div class="form-group">
          <label for="email">Correo Electrónico:</label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="ejemplo@correo.com"
            required
          />
        </div>

        <!-- Método de Pago (Pagadito) -->
        <div class="form-group">
          <label for="payment">Método de Pago:</label>
          <select id="payment" name="payment" required>
            <option value="pagadito">Pagadito</option>
          </select>
        </div>

        <!-- Botón Comprar -->
        <button type="submit" class="btn-purchase">
          Ir a pagar y generar mi código Ride
        </button>
      </form>
    </div>
  </section>

  <!-- MENSAJE O RESUMEN -->
  <section class="purchase-summary">
    <div class="container">
      <h2>¿Ya compraste tu plan?</h2>
      <p>
        Revisa tu correo o comprobante. Ingresa tu
        <strong>código Ride</strong> en la app <strong>Ride Driver</strong>
        en la opción <strong>"Ya tengo un código Ride"</strong> para activar tu suscripción.
      </p>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-container">
      <p>&copy; 2025 Ride - Todos los derechos reservados</p>
      <nav class="footer-nav">
        <a href="contacto.html">Contacto</a>
        <a href="#">Términos y Condiciones</a>
        <a href="#">Política de Privacidad</a>
      </nav>
    </div>
  </footer>

  <!-- LÓGICA: FILTRAR PLANES SEGÚN VEHÍCULO + PRESELECCIÓN DESDE URL -->
  <script>
    (function () {
      const vehicleSelect = document.getElementById('vehicle');
      const planSelect = document.getElementById('plan');
      const allPlanOptions = Array.from(planSelect.options).filter(
        opt => opt.value !== "" // excluir placeholder
      );

      function filtrarPlanesPorVehiculo(vehiculo) {
        // Reset selección
        planSelect.value = "";
        planSelect.disabled = !vehiculo;

        // Si no hay vehículo seleccionado, mostrar solo placeholder
        if (!vehiculo) {
          Array.from(planSelect.options).forEach(opt => {
            if (opt.value === "") {
              opt.hidden = false;
            } else {
              opt.hidden = true;
            }
          });
          return;
        }

        // Mostrar solo los que coinciden con el data-vehicle
        Array.from(planSelect.options).forEach(opt => {
          if (opt.value === "") {
            opt.hidden = false;
            opt.selected = true;
            opt.textContent = "Selecciona un plan para tu " + (vehiculo === "car" ? "Carro" : "Moto");
          } else {
            const optVehicle = opt.getAttribute('data-vehicle');
            opt.hidden = optVehicle !== vehiculo;
          }
        });
      }

      // Cambio manual del usuario
      vehicleSelect.addEventListener('change', function () {
        const vehiculo = this.value;
        filtrarPlanesPorVehiculo(vehiculo);
      });

      // Preselección desde parámetros ?vehicle=car&plan=basic
      const params = new URLSearchParams(window.location.search);
      const vehicleParam = params.get('vehicle');
      const planParam = params.get('plan');

      if (vehicleParam === 'car' || vehicleParam === 'moto') {
        vehicleSelect.value = vehicleParam;
        filtrarPlanesPorVehiculo(vehicleParam);

        if (planParam) {
          const key = (vehicleParam === 'car' ? 'CAR' : 'M') + '-' + planParam.toUpperCase();
          const match = Array.from(planSelect.options).find(
            opt => opt.value === key && !opt.hidden
          );
          if (match) {
            planSelect.value = key;
          }
        }
      } else {
        // Estado inicial: sin vehículo → solo placeholder visible, select deshabilitado
        filtrarPlanesPorVehiculo(null);
      }
    })();
  </script>
</body>
</html>



